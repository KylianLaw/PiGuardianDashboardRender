{% extends "base.html" %}

{% block title %}PiGuardian ‚Äì Home{% endblock %}

{% block content %}
<div class="summary-page">

    <!-- HERO / PROJECT PROMO -->
    <section class="summary-hero">
        <div class="summary-hero__text">
            <p class="summary-hero__eyebrow">Welcome to</p>
            <h1 class="summary-hero__title">PiGuardian Smart Home Dashboard</h1>
            <p class="summary-hero__subtitle">
                Monitor your home environment, control your IoT devices
                and keep your security system under control ‚Äì all from one place.
            </p>

            <div class="summary-hero__badges">
                <span class="summary-hero__badge">üå° Live environment data</span>
                <span class="summary-hero__badge">üõ° Motion &amp; smoke security</span>
                <span class="summary-hero__badge">üí° Remote device control</span>
            </div>

            <div class="summary-hero__cta-row">
                <a class="summary-btn summary-btn--primary" href="{{ url_for('environment_page') }}">
                    View environment
                </a>
                <a class="summary-btn summary-btn--ghost" href="{{ url_for('security_control') }}">
                    Open security center
                </a>
            </div>
        </div>

        <!-- Animated ‚Äúimage‚Äù (CSS animated orb) -->
        <div class="summary-hero__visual">
            <div class="summary-hero__orb">
                <div class="summary-hero__icon">üè†</div>
                <div class="summary-hero__pulse summary-hero__pulse--one"></div>
                <div class="summary-hero__pulse summary-hero__pulse--two"></div>
            </div>
            <p class="summary-hero__visual-caption">
                Your home at a glance ‚Äì updated in real time.
            </p>
        </div>
    </section>

    <!-- MAIN GRID: 3 environment cards -->
    <section class="summary-grid">
        <!-- Temperature card -->
        <article class="summary-card">
            <div class="summary-card__header">
                <span class="summary-card__label">Temperature</span>
                <span class="summary-card__badge">Indoor</span>
            </div>
            <div class="summary-card__value-row">
                <span id="sum-temp-value" class="summary-card__value">‚Äî</span>
                <span class="summary-card__unit">¬∞C</span>
            </div>
            <p class="summary-card__footer">
                Last update
                <span id="sum-temp-time" class="summary-card__time">‚Äî</span>
            </p>
        </article>

        <!-- Humidity card -->
        <article class="summary-card">
            <div class="summary-card__header">
                <span class="summary-card__label">Humidity</span>
                <span class="summary-card__badge badge--blue">Indoor</span>
            </div>
            <div class="summary-card__value-row">
                <span id="sum-hum-value" class="summary-card__value">‚Äî</span>
                <span class="summary-card__unit">%</span>
            </div>
            <p class="summary-card__footer">
                Last update
                <span id="sum-hum-time" class="summary-card__time">‚Äî</span>
            </p>
        </article>

        <!-- Pressure card (simulated) -->
        <article class="summary-card">
            <div class="summary-card__header">
                <span class="summary-card__label">Pressure</span>
                <span class="summary-card__badge badge--purple">Simulated</span>
            </div>
            <div class="summary-card__value-row">
                <span id="sum-press-value" class="summary-card__value">‚Äî</span>
                <span class="summary-card__unit">hPa</span>
            </div>
            <p class="summary-card__footer">
                Source
                <span class="summary-card__time">Randomized</span>
            </p>
        </article>
    </section>

    <!-- QUICK ACTIONS -->
    <section class="summary-actions">
        <h2 class="summary-actions__title">Quick navigation</h2>
        <div class="summary-actions__buttons">
            <a class="summary-btn summary-btn--primary" href="{{ url_for('environment_page') }}">
                Environment dashboard
            </a>
            <a class="summary-btn summary-btn--warning" href="{{ url_for('security_control') }}">
                Security center
            </a>
            <a class="summary-btn summary-btn--ghost" href="{{ url_for('devices_control') }}">
                Device control
            </a>
            <a class="summary-btn summary-btn--ghost" href="{{ url_for('about_page') }}">
                About this project
            </a>
        </div>
    </section>

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    fetch('/api/environment/summary')
        .then(r => r.json())
        .then(data => {
            const tempEl = document.getElementById('sum-temp-value');
            const humEl  = document.getElementById('sum-hum-value');
            const pressEl = document.getElementById('sum-press-value');
            const tempTimeEl = document.getElementById('sum-temp-time');
            const humTimeEl  = document.getElementById('sum-hum-time');

            const formatTime = (ts) => {
                if (!ts) return '‚Äî';
                const d = new Date(ts);
                if (isNaN(d.getTime())) return ts;
                return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            };

            if (data.temperature != null) {
                tempEl.textContent = Number(data.temperature).toFixed(1);
                tempTimeEl.textContent = formatTime(data.timestamp);
            }

            if (data.humidity != null) {
                humEl.textContent = Number(data.humidity).toFixed(1);
                humTimeEl.textContent = formatTime(data.timestamp);
            }

            if (data.pressure != null) {
                pressEl.textContent = Number(data.pressure).toFixed(1);
            }
        })
        .catch(err => {
            console.error('Error loading environment summary:', err);
        });
});
</script>
{% endblock %}
